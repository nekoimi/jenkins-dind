variables:
  DOCKERHUB_URL: https://index.docker.io/v1/
  DOCKERHUB_IMAGE: nekoimi/jenkins-plus:latest

cache:
  paths:
    - /root/.docker/config.json

stages:
  - build
  - push

build-job:
  stage: build
  only:
    - master
  tags:
    - docker
  script:
    - docker login -u $DOCKERHUB_USERNAME -p $DOCKERHUB_ACCESS_TOKEN $DOCKERHUB_URL
    - docker build -t $DOCKERHUB_IMAGE .

push-job:
  stage: push
  only:
    - master
  tags:
    - docker
  script:
    - docker push $DOCKERHUB_IMAGE
